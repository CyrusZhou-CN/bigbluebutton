# Configuration for the BigBlueButton "video" recording format.
# Do not modify this file!
# Settings can be customized by creating the file /etc/bigbluebutton/recording/video.yml

# Location in the filesystem where the published recording should be written to
publish_dir: /var/bigbluebutton/published/video

# Location within the filesystem where the playback support files can be found
# (they will get copied into the published recording directory)
playback_dir: /usr/local/bigbluebutton/core/playback/video

# offset applied to audio in the output video file
# audio_offset = 1000 means that the audio will be delayed by 1000ms
audio_offset: 0

# The preset to use for a specific meeting can be set using the bbb-recording-video-preset meta
# parameter. This default will be used if no preset is set, or if a value is specified which does
# not match a known preset.
default_preset: "720p"

# Whether to allow the preset to be configured via the bbb-recording-video-preset meta parameter.
allow_meta_preset: true

# The codec that will be used by the intermediate file generated by the bbb-presentation-video
# tool, containing the presentation/whiteboard area. The options are "vp9" or "h264".
bbb_presentation_video_codec: "h264"

# The list of "presets". Each preset corresponds to a specific use case and output quality.
# For each preset, you can specify the size of the output video, how to lay out content in the
# video, and what audio/video encoding settings to use.
#
# The list of presets provided in /etc/bigbluebutton/recording/video.yml will be combined with
# the list of presets shown here. If you create a preset with the same name as one of these
# presets, your preset will *replace* the preset from this file.
presets:
  # Each preset is identified by name
  1080p:
    # The top level 'layout' key is required.
    # It specifies the width, height, and framerate of the output video, and also the default
    # arrangement of content regions within the rendered video.
    layout:
      width: 1920
      height: 1080
      framerate: 24
      areas:
        # Each area must specify a 'name', which says the type of content to display in this area.
        # Supported values are:
        # * 'presentation' (uploaded slides and whiteboard annotations)
        # * 'webcam' (a grid of participant webcam videos)
        # * 'deskshare' (the presenter's shared screen or window)
        # If there is no content of the specified type, the area will not be displayed.
        # If areas overlap, later areas will be drawn over top of earlier areas.
        - { name: presentation, x: 0, y: 0, width: 1600, height: 1080 }
        - { name: webcam, x: 1600, y: 0, width: 320, height: 1080 }
        # Since the deskshare is listed after the presentation area, the deskshare will cover/hide the
        # presentation area while deskshare is in use. The presentation will be visible again after
        # the deskshare stops.
        - { name: deskshare, x: 0, y: 0, width: 1600, height: 1080 }

    # The 'layouts' key is optional. It allows you to specify alternate layouts to use depending on
    # which types of content were shared in the session.
    layouts:
      # Each layout can specify a list of 'required' content types.
      # The layout will only be used if all of the 'required' content types are present in the
      # session.
      # Each layout also specifies 'areas', in the same format as the 'layout' key.
      # The layout will only be used if an area is available for every content type which is
      # present in the session.
      #
      # The order of layouts is important - the first one that matches will be used.
      # If none of the layouts specified here match, then the layout from the 'layout' key will be
      # used instead.

      # Have the webcams cover the whole area of the video if the session did not use screenshare
      # or the presentation area
      - required: [ webcam ]
        areas:
          - { name: webcam, x: 0, y: 0, width: 1920, height: 1080 }

      # Have the presentation area and deskshare cover the whole area of the video if the session
      # did not have any webcams shared
      - areas:
          - { name: presentation, x: 0, y: 0, width: 1920, height: 1080 }
          - { name: deskshare, x: 0, y: 0, width: 1920, height: 1080 }

    # A list of output video file formats and encoding settings to use for this preset
    formats:
      # The default format is very fast to generate, and works by copying the temporary video
      # (using the working format codec defined in core/lib/recordandplayback/edl/video.rb) without
      # an extra re-encoding step.
      - mimetype: 'video/mp4'
        extension: m4v
        parameters:
          - [ '-c:v', 'copy',
              '-c:a', 'aac', '-b:a', '128K',
              '-f', 'mp4', '-movflags', 'faststart' ]
        postprocess: []

      # An alternative is to re-encode the video to vp9. The options selected here are inspired by
      # Google's recommended settings for VOD:
      # https://developers.google.com/media/vp9/settings/vod/#recommended_settings
      # but use slightly higher bitrate/quality settings in order to preserve details in slides and
      # screen sharing.
      #- mimetype: 'video/webm;codecs="vp09.00.41.08,opus"'
      #  extension: webm
      #  parameters:
      #    # Moderate speed single-pass encode
      #    - [ '-c:v', 'libvpx-vp9', '-level', '4.1', '-b:v', '3000K', '-minrate', '1500K', '-maxrate', '4350K',
      #        '-crf', '24', '-quality', 'good', '-speed', '2', '-tile-columns', '2', '-threads', '2',
      #        '-g', '240',
      #        '-c:a', 'libopus', '-b:a', '64K',
      #        '-f', 'webm' ]
      #    # Alternative: Slower but better quality two-pass encode
      #    #- [ '-c:v', 'libvpx-vp9', '-level', '4.1', '-b:v', '3000K', '-minrate', '1500K', '-maxrate', '4350K',
      #    #    '-crf', '24', '-quality', 'good', '-pass', '1', '-speed', '4', '-tile-columns', '2', '-threads', '2',
      #    #    '-g', '240',
      #    #    '-an',
      #    #    '-f', 'webm' ]
      #    #- [ '-c:v', 'libvpx-vp9', '-level', '4.1', '-b:v', '3000K', '-minrate', '1500K', '-maxrate', '4350K',
      #    #    '-crf', '24', '-quality', 'good', '-pass', '2', '-speed', '2', '-tile-columns', '2', '-threads', '2',
      #    #    '-g', '240',
      #    #    '-c:a', 'libopus', '-b:a', '64K',
      #    #    '-f', 'webm' ]
      #    postprocess:
      #      - [ 'mkclean', '--quiet', ':input', ':output' ]

  720p:
    layout:
      width: 1280
      height: 720
      framerate: 24
      areas:
        - { name: presentation, x: 0, y: 0, width: 960, height: 720 }
        - { name: webcam, x: 960, y: 0, width: 320, height: 720 }
        - { name: deskshare, x: 0, y: 0, width: 960, height: 720 }
    layouts:
      # Have the webcams cover the whole area of the video if the session did not use screenshare
      # or the presentation area
      - required: [ webcam ]
        areas:
          - { name: webcam, x: 0, y: 0, width: 1280, height: 720 }
      # Have the presentation area and deskshare cover the whole area of the video if the session
      # did not have any webcams
      - areas:
          - { name: presentation, x: 0, y: 0, width: 1280, height: 720 }
          - { name: deskshare, x: 0, y: 0, width: 1280, height: 720 }
    
    formats:
      - mimetype: 'video/mp4'
        extension: m4v
        parameters:
          - [ '-c:v', 'copy',
              '-c:a', 'aac', '-b:a', '128K',
              '-f', 'mp4', '-movflags', 'faststart' ]
        postprocess: []

      # An alternative is to re-encode the video to vp9. The options selected here are inspired by
      # Google's recommended settings for VOD:
      # https://developers.google.com/media/vp9/settings/vod/#recommended_settings
      # but use slightly higher bitrate/quality settings in order to preserve details in slides and
      # screen sharing.
      #- mimetype: 'video/webm;codecs="vp09.00.41.08,opus"'
      #  extension: webm
      #  parameters:
      #    # Moderate speed single-pass encode
      #    - [ '-c:v', 'libvpx-vp9', '-level', '4.1', '-b:v', '1800K', '-minrate', '900K', '-maxrate', '2610K',
      #        '-crf', '31', '-quality', 'good', '-speed', '2', '-tile-columns', '2', '-threads', '2',
      #        '-g', '240',
      #        '-c:a', 'libopus', '-b:a', '64K',
      #        '-f', 'webm' ]
      #    # Alternative: Slower but better quality two-pass encode
      #    #- [ '-c:v', 'libvpx-vp9', '-level', '4.1', '-b:v', '1800K', '-minrate', '900K', '-maxrate', '2610K',
      #    #    '-crf', '31', '-quality', 'good', '-pass', '1', '-speed', '4', '-tile-columns', '2', '-threads', '2',
      #    #    '-g', '240',
      #    #    '-an',
      #    #    '-f', 'webm' ]
      #    #- [ '-c:v', 'libvpx-vp9', '-level', '4.1', '-b:v', '1800K', '-minrate', '900K', '-maxrate', '2610K',
      #    #    '-crf', '31', '-quality', 'good', '-pass', '2', '-speed', '2', '-tile-columns', '2', '-threads', '2',
      #    #    '-g', '240',
      #    #    '-c:a', 'libopus', '-b:a', '64K',
      #    #    '-f', 'webm' ]
      #    postprocess:
      #      - [ 'mkclean', '--quiet', ':input', ':output' ]
